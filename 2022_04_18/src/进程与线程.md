# 1.理解进程

**进程是什么？**

* 通俗的将就是“跑起来”的程序。

  * 我们的电脑上都有许多的 .exe 的可执行文件，当我们没有双击的时候，它们就只是静静的躺在那儿。如果我们双击其中的任意一个，这时 **操作系统** 就会将这个 .exe 文件加载到 **内存** 中，并让 CPU 一条一条的执行其中的指令。而这个时候，这个被双击的 .exe 文件就没有躺在那儿了，它已经开始了自己的工作。**我们称这就是一个进程！！！**

  

**线程又是什么？**

* 线程是包含在进程里的，一个进程里可以有一个或多个线程。
  * 举个例子，线程就好比一个火车站，而线程就就是火车站里的一个个售票窗口。



### 操作系统是如何管理进程的？

* 1. **先对一个进程进行描述**（主要是明确这个进程上有哪些属性）。

  * 由于操作系统主要是由 C/C++ 来实现的，所以它在进行 进程 描述时使用的是C语言中的结构体类型。（和 JAVA 中的类差不多，但结构体的功能更加简单）

  * 同时这个结构体也有一个名字 — 进程控制块（Process Control Block /PCB）

    

*   2.**然后对若干个进程进行组织**（主要是使用数据结构将若干进程的信息放到一起，方便增删改查）。

  * 在 **Linux** 下，使用的数据结构就是一个 **双向链表** 。它把每个 PCB 给串了起来。

  * 由于它是一个双向链表的结构，所以 **创建进程** 就是 创建出一个 PCB ，然后将 PCB 给加到双向链表中。**销毁进程** 就是将对应的 PCB 从链表中拿出来。**查看进程** 就是遍历整个链表。

    

------

## PCB中有哪些属性？

**（基础属性）**

* PID：进程的标识符（id），关系就与人和身份证一样，一一对应。

* 内存指针：这个属性主要是指明进程在执行时的一些指令和数据在内存中所存放的位置。
  * 一个 .exe 可执行程序被运行时，它就会被操作系统给加载到内存中变成进程。进程想要正常执行，就需要被分配一些系统资源。
* 文件描述符表：一个进程在执行的过程中，难免需要和文件打交道。我们有知道文件是存放在硬盘上的。所以当一个进程每打开一个文件时，就会在文件描述符表上增加一项，用来记录文件的相关信息。
  * 文件描述符表可以看做一个数组，每一个元素就是一个结构体。每个结构体里面就存放了一个文件的相关信息。
  * 同时，每一个进程一启动。那它就会自动打开三个文件：**System.in(标准输入)、System.out(标准输出)、System.err(标准错误)**。
  * 文件描述符表这个数组的下标，就叫文件描述符。



**（为实现进程调度的属性）**

* 状态：字面意思就是描述了当前进程的状态是怎样的，比如 **就绪状态、阻塞状态、睡眠状态等**。

  * 就绪状态：这时代表当前进程已经做好了准备，一旦拿到 CPU 的时间片段，便会立马进入执行。
  * 阻塞状态/睡眠状态：这两个状态都是一个意思，就是当前进程即使拿到了CPU的时间片段，也是不能执行。只能让其他处于就绪状态的进程来执行。

  

* 优先级：**这个属性决定了 先给哪个进程分配时间片段，后给哪个进程分配时间片段。同时也决定了 分给谁的时间片段多，谁的少**。

  

* 记账信息：**这个属性就是为了统计一些信息，方便给进程调度提供参考**。统计的信息一般包括：哪些进程先分配的，哪些后分配的，哪些分配的多，哪些分配的少。哪些进程等待的时间长，哪些等待的时间短等信息。这样做的好处就是可以使分配变得更加合理。

  

* 上下文：这个使用游戏中的术语很好理解，存档/读档。因为一个进程拿到的时间片段大概率是不能支持当前进程执行完毕的。所以如果不记录下当前执行到的位置，就会导致出现问题。而上下文就是专门为这个服务的。**进程在被调度出CPU之前，就会将CPU中所有寄存器的数据存放到内存中，也就是对应PCB中的上下文字段里。下次再拿到时间片段，被调度上CPU时，就从内存中恢复数据到寄存器中。并接着往下执行。**



### 总结：所谓的调度，就是合理、高效的分配CPU的资源。— 时间管理大师



------



## 用一个例子，更加深刻的理解进程（这里默认是一个进程里只有一个线程）的调度(准确的是说是线程的调度)。

* 小美是一个很美丽的女孩，她交了3个男朋友，分别是小张，小李和小王。

**平常的时候小张、小李和小王就处于就绪状态，随时可以和小美去约会。**

* 有一天小张因为工作原因而出差了。所以小美在小张出差的时间段里就不能和他约会。

**这时我们就称小张处于阻塞状态。**

* 后来她为了不让3个男朋友在同一时刻碰面，所以她就排了一个日程表：

  由于小美在这三个男朋友中最喜欢小王，其次比较喜欢小张，最后才是小李。

  所以她这样安排(比较喜欢的先安排)：

  * 周一 至 周二 和 小王约会。

  * 周三 至 周四 和 小张约会。

  * 周五 至 周六 和 小李约会。

**这时我们就可以说小王的优先级最高、小张其次、小李最后。**

* 后来过了一段时间，小李发现小美对他爱答不理，所以就对小美的好感度慢慢降低。这时小美也发现小李对她不够热情了。所以她对日程表有了新的安排，将小李的优先级往上提了提：
  * 周一 至 周二 和 小李约会。
  * 周三 至 周四 和 小王约会。
  * 周五 至 周六 和 小张约会。

**这时我们就可以说这是通过记账信息来调整的。**

* 小美有一次在和小张约会时，小张告诉她，他过几天就要生日了，他想要小美给她准备一件礼物，小美也欣然答应。后面小美在和小王约会时，小王又告诉小美，他邀请小美和他一起去旅游。叫小美提前准备准备，小美一听，可以免费旅游，也就开心的同意了。小美约完会回家后，以防自己忘记这些事，所以她就用了一个小本本将这些信息都记录了下来。

**这时我们就可以理解为上下文中的 存档，就跟玩游戏 存档 一样。当下一次小美和对应的男朋友约会时，她就能通过提前查看小本本，而和所对应的男朋友持续上次约会时的话题。**



------



## 内存资源的分配问题？

